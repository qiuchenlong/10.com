!function(t,e){"function"==typeof define&&define.amd?define([],function(){return t.PxLoader=e()}):"object"==typeof module&&module.exports?module.exports=e():t.PxLoader=e()}(this,function(){function t(t){t=t||{},this.settings=t,null==t.statusInterval&&(t.statusInterval=5e3),null==t.loggingDelay&&(t.loggingDelay=2e4),null==t.noProgressTimeout&&(t.noProgressTimeout=1/0);var n,r=[],o=[],i=[],s=Date.now(),a={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},u=function(t){return null==t?[]:Array.isArray(t)?t:[t]};this.add=function(t){t.tags=new e(t.tags),null==t.priority&&(t.priority=1/0),r.push({resource:t,status:a.QUEUED})},this.addProgressListener=function(t,n){i.push({callback:t,tags:new e(n)})},this.addCompletionListener=function(t,n){o.push({tags:new e(n),callback:function(e){e.completedCount===e.totalCount&&t(e)}})};var l=function(t){t=u(t);var e=function(e){for(var n=e.resource,r=1/0,o=0;o<n.tags.length;o++)for(var i=0;i<Math.min(t.length,r)&&!(n.tags.all[o]===t[i]&&i<r&&0===(r=i))&&0!==r;i++);return r};return function(t,n){var r=e(t),o=e(n);return r<o?-1:r>o?1:t.priority<n.priority?-1:t.priority>n.priority?1:0}};this.start=function(t){n=Date.now();var e=l(t);r.sort(e);for(var o=0,i=r.length;o<i;o++){var s=r[o];s.status=a.WAITING,s.resource.start(this)}setTimeout(c,100)};var c=function(){for(var e=!1,n=Date.now()-s,o=n>=t.noProgressTimeout,i=n>=t.loggingDelay,u=0,l=r.length;u<l;u++){var h=r[u];h.status===a.WAITING&&(h.resource.checkStatus&&h.resource.checkStatus(),h.status===a.WAITING&&(o?h.resource.onTimeout():e=!0))}i&&e&&g(),e&&setTimeout(c,t.statusInterval)};this.isBusy=function(){for(var t=0,e=r.length;t<e;t++)if(r[t].status===a.QUEUED||r[t].status===a.WAITING)return!0;return!1};var h=function(t,e){var n,u,l,c,h=null;for(n=0,u=r.length;n<u;n++)if(r[n].resource===t){h=r[n];break}if(null!=h&&h.status===a.WAITING)for(h.status=e,s=Date.now(),l=i.concat(o),n=0,u=l.length;n<u;n++)c=l[n],(0===c.tags.length||t.tags.intersects(c.tags))&&f(h,c)};this.onLoad=function(t){h(t,a.LOADED)},this.onError=function(t){h(t,a.ERROR)},this.onTimeout=function(t){h(t,a.TIMEOUT)};var f=function(t,e){var n,o,i,s=0,u=0;for(n=0,o=r.length;n<o;n++)i=r[n],!1,(0===e.tags.length||i.resource.tags.intersects(e.tags))&&(u++,i.status!==a.LOADED&&i.status!==a.ERROR&&i.status!==a.TIMEOUT||s++);e.callback({resource:t.resource,loaded:t.status===a.LOADED,error:t.status===a.ERROR,timeout:t.status===a.TIMEOUT,completedCount:s,totalCount:u})},g=this.log=function(t){if(window.console){var e=Math.round((Date.now()-n)/1e3);window.console.log("PxLoader elapsed: "+e+" sec");for(var o=0,i=r.length;o<i;o++){var s=r[o];if(t||s.status===a.WAITING){var u="PxLoader: #"+o+" "+s.resource.getName();switch(s.status){case a.QUEUED:u+=" (Not Started)";break;case a.WAITING:u+=" (Waiting)";break;case a.LOADED:u+=" (Loaded)";break;case a.ERROR:u+=" (Error)";break;case a.TIMEOUT:u+=" (Timeout)"}s.resource.tags.length>0&&(u+=" Tags: ["+s.resource.tags.all.join(",")+"]"),window.console.log(u)}}}}}function e(t){if(this.all=[],this.first=null,this.length=0,this.lookup={},t){if(Array.isArray(t))this.all=t.slice(0);else if("object"==typeof t)for(var e in t)t.hasOwnProperty(e)&&this.all.push(e);else this.all.push(t);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var n=0;n<this.length;n++)this.lookup[this.all[n]]=!0}}return e.prototype.intersects=function(t){if(0===this.length||0===t.length)return!1;if(1===this.length&&1===t.length)return this.first===t.first;if(t.length<this.length)return t.intersects(this);for(var e in this.lookup)if(t.lookup[e])return!0;return!1},t}),function(t,e){"function"==typeof define&&define.amd?define(["pxloader"],function(n){return t.PxLoaderImage=e(n)}):"object"==typeof module&&module.exports?module.exports=e(require("pxloader")):t.PxLoaderImage=e(t.PxLoader)}(this,function(t){function e(t,e,n,r){r=r||{};var o,i=this,s=null;o=this.img=new Image,r.origin&&(o.crossOrigin=r.origin),this.tags=e,this.priority=n;var a=function(){"complete"===i.img.readyState&&u()},u=function(){s.onLoad(i),h()},l=function(){s.onError(i),h()},c=function(){s.onTimeout(i),h()},h=function(){i.unbind("load",u),i.unbind("readystatechange",a),i.unbind("error",l)};this.start=function(e){s=e,i.bind("load",u),i.bind("readystatechange",a),i.bind("error",l),i.img.src=t},this.checkStatus=function(){a()},this.onTimeout=function(){i.img.complete?u():c()},this.getName=function(){return t},this.bind=function(t,e){i.img.addEventListener(t,e,!1)},this.unbind=function(t,e){i.img.removeEventListener(t,e,!1)}}return t.prototype.addImage=function(t,n,r,o){var i=new e(t,n,r,o);return this.add(i),i.img},e});